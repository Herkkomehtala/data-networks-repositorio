
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tietoverkkokurssin dokumentaatio">
      
      
        <meta name="author" content="Herkko Mehtälä / JAMK">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.9">
    
    
      
        <title>TCP ja UDP - Tietoverkkokurssin dokumentaatio</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2b4465f4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tcp-ja-udp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Tietoverkkokurssin dokumentaatio" class="md-header__button md-logo" aria-label="Tietoverkkokurssin dokumentaatio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tietoverkkokurssin dokumentaatio
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              TCP ja UDP
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Tietoverkkokurssin dokumentaatio" class="md-nav__button md-logo" aria-label="Tietoverkkokurssin dokumentaatio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Tietoverkkokurssin dokumentaatio
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Tietoverkkokurssin dokumentaatio
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E01/" class="md-nav__link">
        Ensimmäiset virtuaalikoneet
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E02/" class="md-nav__link">
        Ensimmäiset kytkimet
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E03/" class="md-nav__link">
        Aliverkkojen laskeminen
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E04/" class="md-nav__link">
        IP-osoitteisuus
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E05/" class="md-nav__link">
        DHCP ja staattinen reititys
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E06/" class="md-nav__link">
        Fyysinen harjoite
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E07/" class="md-nav__link">
        STP
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E08/" class="md-nav__link">
        OSPF
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E09/" class="md-nav__link">
        Palomuuraaminen
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E10/" class="md-nav__link">
        NAT
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          TCP ja UDP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        TCP ja UDP
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#verkon-sisainen-testaus" class="md-nav__link">
    Verkon sisäinen testaus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcp-wiresharkkailu" class="md-nav__link">
    TCP Wiresharkkailu
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#udp-wiresharkkailu" class="md-nav__link">
    UDP Wiresharkkailu
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E12/" class="md-nav__link">
        Verkon hallinta
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E13/" class="md-nav__link">
        Apache palvelin
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E14/" class="md-nav__link">
        WLAN
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../E15/" class="md-nav__link">
        DNS
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#verkon-sisainen-testaus" class="md-nav__link">
    Verkon sisäinen testaus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcp-wiresharkkailu" class="md-nav__link">
    TCP Wiresharkkailu
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#udp-wiresharkkailu" class="md-nav__link">
    UDP Wiresharkkailu
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="tcp-ja-udp">TCP ja UDP</h1>
<p>Aloitan muuttamalla Lubuntu1 verkkoadapterin asetuksia vaihtamalla se <code>bridged network</code> -tilaan.  </p>
<p>Boottaan Lubuntu1 ja aloitan testin syöttämällä komennon <code>iperf -c iperf.he.net</code>  </p>
<p><img alt="Kuva iperf tuloksesta" src="1_iperf.jpg" />  </p>
<p>Kuvasta näkee, että komennolla luodaan <code>TCP</code> yhteys palvelimeen käyttäen porttia <code>5001</code>. Huomioitavaa on, että minä käytän tässä tapauksessa porttia <code>49700</code>. <code>TCP window size</code> kertoo kuinka suurta ikkunaa käytetään. Tässä tapauksessa 85 kilotavun ikkunoita. Näen myös kuvasta kuinka paljon dataa on siirretty yhteensä ja kaistanleveyden. Tämä voi olla tärkeää tietoa tietoverkkojen testauksessa.  </p>
<p>On mahdollista käyttää <code>-t</code> -parametria jolla voidaan muuttaa testauksen aikaa. <code>-i</code> parametrilla voidaan raportoida tuloksia eri välein. Kokeilen lähettää dataa 15 sekunnin ajaksi ja mittaan tuloksia joka sekuntti komennolla <code>iperf -c iperf.he.net -t 15 -i 1</code>.  </p>
<p><img alt="Kuva iperf tuloksesta" src="2_iperf_TCP.jpg" />   </p>
<p>Kuvasta näen, että kaista muuttuu kokoajan. Tämä johtuu siitä, että kulkevassa yhteydessä ikkunoiden koko muuttuu kokoajan. TCP käyttää mahdollisimman paljon kaistanleveyttä ja osapuolet neuvottelevat kokoajan ikkunan koosta. Tämä aiheuttaa kuvassa näkyvän vaihtelun.  </p>
<p>Nyt testaan samaa komentoa, mutta lisään parametrin <code>-u</code> joka vaihtaa protokollan UDP:ksi. UDP ei käytä niin paljon kaistaa kuten TCP joten katsotaan mikä on tulos...  </p>
<p><img alt="Kuva iperf tuloksesta" src="3_iperf_UDP.jpg" />  </p>
<p>Kaistanleveys pysyy lähes samana kokoajan. UDP:ssä ei suoriteta alkukättelyä, pakettien kuittausta eikä yhteyden lopettamista. Kuten tästä näkee, se ei silti ole nopeampi kuin TCP, koska TCP:n liukuva ikkuna kompensoi tehokkaasti kuittausten viemää aikaa.  </p>
<h2 id="verkon-sisainen-testaus">Verkon sisäinen testaus</h2>
<p>Boottaan tietoverkkoni ja päätän, että Lubuntu3 on Iperf palvelin. Teen tämän syöttämällä sille komennon <code>iperf -s</code>. Käytän Lubuntu2 clienttina jolla testaan tietoliikennettä. Kuvasta näkee tarkemmin, mitkä laitteet ovat mitäkin. <strong>HUOM</strong> Kuva on Layer 3 näkökulmasta.  </p>
<p><img alt="Kuva iperf palvelimesta ja clientista" src="4_verkko.jpg" />  </p>
<p>Aloitan testauksen syöttämällä komennon <code>iperf -c 192.168.89.130 -i 1</code> jotta näen tulokset joka sekuntti. Katsotaan mikä on tulos...  </p>
<p><img alt="Kuva iperf tuloksesta" src="5_iperf_TCP.jpg" />  </p>
<p>Kuvasta näen, että verkkoni kaistanleveys leijuu noin 1,8 Mbit/s alueella. TCP ikkunan neuvottelu isontaa kaistaa välillä jopa 3Mbit/s hetkeksi. Huomattavaa on myös, että client käyttää porttia 40906 kommunikoidakseen.  </p>
<p>Nyt testaan samaa komentoa, mutta käytän UDP protokollaa. Katsotaan miten käy...  </p>
<p><img alt="Kuva iperf tuloksesta" src="6_iperf_UDP.jpg" />  </p>
<p>Näen, että kaistanleveys on aika tasaisesti 1Mbit/s alueella. UDP:ssä ei ole liukuvaa ikkunaa joten kaistanleveyden vaihtelevuutta ei normaalistä nähdä toisin kuin TCP:ssä.  </p>
<h2 id="tcp-wiresharkkailu">TCP Wiresharkkailu</h2>
<p>Boottaan kolmannen Lubuntun joka toimii wiresharkkina. Kytken sen Lubuntu2 verkkoon odottamaan tulevia yhteyksiä.  </p>
<p>Lataan iperf -palvelimen koneelta index.html tiedoston komennolla <code>wget 192.168.89.130</code>:  </p>
<p><img alt="Kuva wgetistä" src="7_wget.jpg" />  </p>
<p>Tämä toimii TCP (ja HTTP) protokollalla, joten minun wiresharkin pitäisi pystyä näkemään TCP:n kolmisuuntaisen kättelyn. Katsotaan mitä löydän...  </p>
<p><img alt="Kuva wiresharkista" src="8_TCP_SYN.jpg" />  </p>
<p>Wiresharkista näen, että TCP kättely on tapahtunut. Ensiksi client (<em>192.168.89.68</em>) lähettää palvelimelle (<em>192.168.89.130</em>) paketin <em>SYN</em> lipulla.  </p>
<p><img alt="Kuva wiresharkista" src="9_SYN_ACK.jpg" />  </p>
<p>Tässä palvelin vastaa clientille TCP kättelyn toisessa vaiheessa <em>SYN ACK</em> lipulla. Tämä tarkoittaa, että palvelin haluaa jatkaa TCP yhteyden luomista.</p>
<p><img alt="Kuva wiresharkista" src="10_ACK.jpg" />  </p>
<p>TCP kättelyn viimeisessä osassa client lähettää paketin <em>ACK</em> lipulla palvelimelle. Tällä varmistetaan, että client on saanut vastauksen palvelimelta ja nyt osapuolet ovat valmiita tiedonsiirtoon.  </p>
<h2 id="udp-wiresharkkailu">UDP Wiresharkkailu</h2>
<p>Boottaan Lubuntu2 uudestaan ja kuuntelen wiresharkilla DHCP kommunikointia. Katsotaan, jos löydän sen...  </p>
<p><img alt="Kuva wiresharkista" src="11_DHCP_UDP.jpg" /><br />
<img alt="Kuva wiresharkista" src="11_DHCP_UDP_2.jpg" />  </p>
<p>Kuvasta näen, että DHCP käyttää UDP protokollaa ja palvelin käyttää porttia 67 joka on DHCP:n standardi portti. Huomattavaa on se, että tässä ei tapahtunut minkäänlaista kättelyä tai verifikaatiota siitä, että toinen osapuoli sai paketin perille. Client huhuili, että onko täällä DHCP palvelinta jonka jälkeen palvelin vastasi takaisin antamalla IP-osoitteen. Tällaista protokollaa kutsutaan <em>"yhteydettömäksi protokollaksi"</em>.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../E10/" class="md-footer__link md-footer__link--prev" aria-label="Previous: NAT" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              NAT
            </div>
          </div>
        </a>
      
      
        
        <a href="../E12/" class="md-footer__link md-footer__link--next" aria-label="Next: Verkon hallinta" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Verkon hallinta
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.960e086b.min.js"></script>
      
    
  </body>
</html>